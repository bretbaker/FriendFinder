<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" type="text/css" href="./css/reset.css">
  <link rel="stylesheet" type="text/css" href="./css/survey.css">
  <script src="https://kit.fontawesome.com/3a51ec4eb7.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Courgette&display=swap" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"
    integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
  <title>FriendFinder - Survey</title>
</head>

<body>
  <!-- Survey Head -->
  <div id="survey-container">
    <h1 id="survey-header">Survey Questions</h1>
    <div class="survey-divider"></div>
    <div id="about-you-form">
      <h2 class="question-title">About You</h2>
      <form>
        Name (Required)<br>
        <input id="new-name" type="text"><br>
        Link to Photo Image (Required)<br>
        <input id="new-image" type="text">
      </form>
    </div>
    <div class="survey-divider"></div>
    <!-- Question 1 -->
    <h2 class="question-title">Question 1</h2>
    <p class="question-text">Your mind is always buzzing with unexplored ideas and plans.</p>
    <select id="q-1">
      <option value="" disabled selected>Select an Option</option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>
    <div class="survey-divider"></div>
    <!-- Question 2 -->
    <h2 class="question-title">Question 2</h2>
    <p class="question-text">Generally speaking, you rely more on your experience than your imagination.</p>
    <select id="q-2">
      <option value="" disabled selected>Select an Option</option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>
    <div class="survey-divider"></div>
    <!-- Question 3 -->
    <h2 class="question-title">Question 3</h2>
    <p class="question-text">You find it easy to stay relaxed and focused even when there is some pressure.</p>
    <select id="q-3">
      <option value="" disabled selected>Select an Option</option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>
    <div class="survey-divider"></div>
    <!-- Question 4 -->
    <h2 class="question-title">Question 4</h2>
    <p class="question-text">You rarely do something just out of sheer curiosity.</p>
    <select id="q-4">
      <option value="" disabled selected>Select an Option</option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>
    <div class="survey-divider"></div>
    <!-- Question 5 -->
    <h2 class="question-title">Question 5</h2>
    <p class="question-text">People can rarely upset you.</p>
    <select id="q-5">
      <option value="" disabled selected>Select an Option</option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>
    <div class="survey-divider"></div>
    <!-- Question 6 -->
    <h2 class="question-title">Question 6</h2>
    <p class="question-text">It is often difficult for you to relate to other people’s feelings.</p>
    <select id="q-6">
      <option value="" disabled selected>Select an Option</option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>
    <div class="survey-divider"></div>
    <!-- Question 7 -->
    <h2 class="question-title">Question 7</h2>
    <p class="question-text">In a discussion, truth should be more important than people’s sensitivities.</p>
    <select id="q-7">
      <option value="" disabled selected>Select an Option</option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>
    <div class="survey-divider"></div>
    <!-- Question 8 -->
    <h2 class="question-title">Question 8</h2>
    <p class="question-text">You rarely get carried away by fantasies and ideas.</p>
    <select id="q-8">
      <option value="" disabled selected>Select an Option</option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>
    <div class="survey-divider"></div>
    <!-- Question 9 -->
    <h2 class="question-title">Question 9</h2>
    <p class="question-text">You think that everyone’s views should be respected regardless of whether they are supported by facts or not.</p>
    <select id="q-9">
      <option value="" disabled selected>Select an Option</option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>
    <div class="survey-divider"></div>
    <!-- Question 10 -->
    <h2 class="question-title">Question 10</h2>
    <p class="question-text">You feel more energetic after spending time with a group of people.</p>
    <select id="q-10">
      <option value="" disabled selected>Select an Option</option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>
    <div class="survey-divider"></div>
    <!-- Submit Button -->
    <div id="submit-button">
      <h3 id="submit-button-text"><i class="fas fa-check-square"></i> Submit</h3>
    </div>
  </div>
  <div id="links-paragraph-div">
    <p id="links-paragraph"><a class="links" href="/api/friends" target="_blank">API Friends List</a> | <a class="links" href="https://github.com/bretbaker808/FriendFinder" target="_blank">GitHub Repo</a></p>
  </div>
  <!-- The Modal -->
  <div id="myModal" class="modal">
  
    <!-- Modal content -->
    <div class="modal-content">
      <h1 id="modal-head">Match Found!</h1>
      <p id="modal-message"></p>
      <img id="modal-img" src="" alt="">
      <a href="/home">
        <div id="home-button">
          <h3 id="home-button-text"><i class="fas fa-home"></i> Home</h3>
        </div>
      </a>
    </div>
  
  </div>
  <script type="text/javascript">
    // Friend constructor utilized on click of submit button; data stored and compared against current database; output produced for user
      $("#submit-button").on('click', () => {

        let newName = $("#new-name").val();
        let newImage = $("#new-image").val();
        let a1 = parseInt($("#q-1").find(':selected').attr('value'));
        let a2 = parseInt($("#q-2").find(':selected').attr('value'));
        let a3 = parseInt($("#q-3").find(':selected').attr('value'));
        let a4 = parseInt($("#q-4").find(':selected').attr('value'));
        let a5 = parseInt($("#q-5").find(':selected').attr('value'));
        let a6 = parseInt($("#q-6").find(':selected').attr('value'));
        let a7 = parseInt($("#q-7").find(':selected').attr('value'));
        let a8 = parseInt($("#q-8").find(':selected').attr('value'));
        let a9 = parseInt($("#q-9").find(':selected').attr('value'));
        let a10 = parseInt($("#q-10").find(':selected').attr('value'));

        // constructor for creating new friend data based on user input
        function Friend(name, image, a1, a2, a3, a4, a5, a6, a7, a8, a9, a10) {
          this.name = name;
          this.photo = image;
          this.score = [a1, a2, a3, a4, a5, a6, a7, a8, a9, a10];
          this.scoreSum = a1 + a2 + a3 + a4 + a5 + a6 + a7 + a8 + a9 + a10;
        };

        let newFriend = new Friend(newName, newImage, a1, a2, a3, a4, a5, a6, a7, a8, a9, a10);
        // friends.push(newFriend);
        // console.log(friends);

        $.post("/api/friends", newFriend, () => {

          console.log('New friend posted to database!');

          $("#new-name").val('');
          $("#new-image").val('');
          $("#q-1").val('');
          $("#q-2").val('');
          $("#q-3").val('');
          $("#q-4").val('');
          $("#q-5").val('');
          $("#q-6").val('');
          $("#q-7").val('');
          $("#q-8").val('');
          $("#q-9").val('');
          $("#q-10").val('');

        });

        $.ajax({
          url: '/api/friends',
          method: 'GET'
        }).then((friendData => {
          
          console.log(friendData);

          let diffArr = [];
          const diffFinder = () => {
            for (let i = 0; i < friendData.length - 1; i++) {
              diffArr.push(Math.abs(friendData[friendData.length - 1].scoreSum - friendData[i].scoreSum));
            }
          };

          const matchMaker = () => {
            let matchIndex = diffArr.indexOf(Math.min(...diffArr));
            $("#modal-message").text(friendData[friendData.length - 1].name + ', you have the greatest compatibility with, ' + friendData[matchIndex].name + '!');
            $("#modal-img").attr('src', friendData[matchIndex].photo);
          };

          diffFinder();
          matchMaker();

          $("#myModal").css('display', 'block');

        }));

      });

      $(".close").on('click', () => {

        $("#myModal").css('display', 'none');

      });
  </script>
</body>

</html>